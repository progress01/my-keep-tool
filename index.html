<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜²å½ˆç­†è¨˜ï¼šV20 (æ™ºæ…§é˜²é‡è¤‡ç‰ˆ)</title>
    <style>
        :root {
            --keep-yellow: #fbbc04;
            --keep-dark: #202124;
            --google-blue: #4285f4;
            --google-green: #34a853;
            --bg-color: #f0f2f5;
            --tag-purple: #a142f4;
            --setting-gray: #5f6368;
        }

        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
            display: flex;
            justify-content: center;
        }

        .dashboard {
            display: flex;
            gap: 30px;
            width: 100%;
            max-width: 1200px;
            align-items: flex-start;
        }

        /* å·¦æ¬„ */
        .editor-panel {
            flex: 60;
            background: #fff;
            padding: 40px;
            border-radius: 12px;
            border-top: 6px solid var(--keep-yellow);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        /* å³æ¬„ */
        .tools-panel {
            flex: 40;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: sticky;
            top: 20px;
            height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .card {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid #eee;
        }

        h2 { margin-top: 0; color: #5f6368; text-align: center; }
        h3 { margin-top: 0; font-size: 1.1rem; color: var(--keep-yellow); }
        
        .section-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--keep-dark);
            border-left: 5px solid var(--keep-yellow);
            padding-left: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .title-resource { border-left-color: var(--google-blue); color: #1967d2; }
        .title-tags { border-left-color: var(--tag-purple); color: var(--tag-purple); }
        .title-settings { border-left-color: var(--setting-gray); color: var(--setting-gray); }

        .chat-bubble {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 8px;
            display: block;
            background: #f1f3f4;
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #dadce0;
        }

        /* è¼¸å…¥æ¡† */
        textarea.input-box {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            line-height: 1.5;
            box-sizing: border-box;
            background-color: #fafafa;
            min-height: 60px;
            resize: vertical;
        }
        textarea.input-box:focus { border-color: var(--keep-yellow); background-color: #fff; outline: none; }
        
        textarea.resource-box {
            border-color: #d2e3fc;
            background-color: #f8fbff;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap; 
            overflow-wrap: anywhere; 
            overflow-x: hidden;
            min-height: 120px;
        }
        textarea.resource-box:focus { border-color: var(--google-blue); background-color: #fff; }

        textarea.tag-box {
            border-color: #e1bee7;
            background-color: #f3e5f5;
            font-weight: bold;
            color: var(--tag-purple);
        }
        textarea.tag-box:focus { border-color: var(--tag-purple); background-color: #fff; }

        .setting-hint-box {
            background-color: #f5f5f5;
            border: 1px dashed #999;
            padding: 15px;
            border-radius: 8px;
            color: #666;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* æŒ‰éˆ• */
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            font-size: 1rem;
            transition: 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .btn-load { background-color: var(--keep-yellow); color: #333; }
        .btn-gen { background-color: var(--keep-dark); color: white; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }

        .btn-tiny {
            background-color: var(--google-blue);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 0.8rem;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-tiny:hover { background-color: #3367d6; }

        .load-zone { background-color: #2d2d2d; color: #fff; border: 2px dashed #555; }
        .load-zone textarea { background: #1a1a1a; color: #0f0; border: 1px solid #444; width: 100%; padding: 10px; box-sizing: border-box; }
        
        .result-zone { border: 2px solid var(--keep-yellow); background: #fff8e1; }
        textarea#final-result { width: 100%; height: 300px; border: none; background: transparent; resize: vertical; font-family: monospace; }

        .section-wrapper { margin-bottom: 25px; }

        @media (max-width: 900px) {
            .dashboard { flex-direction: column; padding: 10px; gap: 20px; }
            .editor-panel, .tools-panel { width: 100%; padding: 20px; box-sizing: border-box; }
            .tools-panel { position: static; height: auto; order: 2; }
            .editor-panel { order: 1; }
        }
    </style>
</head>
<body>

<div class="dashboard">

    <div class="editor-panel">
        <h2>ğŸ“ é˜²å½ˆç­†è¨˜ V20 (æ™ºæ…§åˆ†æµç‰ˆ)</h2>
        
        <div class="section-wrapper">
            <div class="section-title">ğŸ’¬ ç‹€æ…‹æ›´æ–° (Status)</div>
            <textarea id="status" class="input-box" placeholder="Ex: 9æœˆè³‡æ–™å·²å®Œæˆï¼Œæ­£åœ¨è£œè·‘ 10æœˆ..."></textarea>
        </div>

        <div class="section-wrapper">
            <div class="section-title title-resource">
                ğŸ“š å°ˆæ¡ˆè³‡æºåº« (Links)
                <button class="btn-tiny" onclick="formatLinks()">âœ¨ æ•´ç†é€£çµ (æ™ºæ…§æ–·è¡Œ)</button>
            </div>
            <textarea id="resources" class="input-box resource-box" placeholder="è²¼ä¸Šæ··äº‚çš„ç¶²å€å¾Œï¼ŒæŒ‰ä¸Šé¢çš„ã€Œæ•´ç†ã€æŒ‰éˆ•ï¼"></textarea>
        </div>

        <div class="section-wrapper">
            <div class="section-title">ğŸ“ å‚™è¨» / é˜²é›·</div>
            <textarea id="memo" class="input-box"></textarea>
        </div>

        <div class="section-wrapper">
            <div class="section-title">ğŸ›¡ï¸ ç›®æ¨™èˆ‡é¢¨éšª</div>
            <textarea id="goal_risk" class="input-box" placeholder="ç¬¬ä¸€è¡Œå¯«ç›®æ¨™&#10;ç¬¬äºŒè¡Œå¯«é¢¨éšª"></textarea>
        </div>

        <hr style="border:0; border-top:1px dashed #ddd; margin:30px 0;">

        <div class="section-wrapper">
            <div class="section-title">A. æš–èº«æº–å‚™ (Ready)</div>
            <textarea id="qa_a" class="input-box"></textarea>
        </div>
        <div class="section-wrapper">
            <div class="section-title">B. æ ¸å¿ƒä»»å‹™ (Main)</div>
            <textarea id="qa_b" class="input-box"></textarea>
        </div>
        <div class="section-wrapper">
            <div class="section-title">C. æˆæœäº¤ä»˜ (Delivery)</div>
            <textarea id="qa_c" class="input-box"></textarea>
        </div>
        <div class="section-wrapper">
            <div class="section-title">D. ç¶“é©—å­˜æª” (Review)</div>
            <textarea id="qa_d" class="input-box"></textarea>
        </div>

        <hr style="border:0; border-top:1px dashed #ddd; margin:30px 0;">

        <div class="section-wrapper">
            <div class="section-title title-tags">ğŸ·ï¸ é—œéµå­— (Keywords)</div>
            <textarea id="tags" class="input-box tag-box" placeholder="#æ¯æœˆ1è™Ÿ #å…¬å¸å°ˆæ¡ˆ"></textarea>
        </div>

        <div class="section-wrapper">
            <div class="section-title title-settings">âš™ï¸ è¨­å®šæª¢æŸ¥ (Settings)</div>
            <div class="setting-hint-box">
                æé†’æ‚¨ï¼š<br>
                1. ğŸ”´ç´…è‰²(æ€¥) / ğŸŸ¢ç¶ è‰²(ç©©)<br>
                2. â°æ™‚é–“æé†’ / ğŸ“åœ°é»æé†’<br>
                3. è‡ªå‹•é™„ä¸Šå·¥å…·é€£çµ
            </div>
        </div>
    </div>

    <div class="tools-panel">
        <div class="card load-zone">
            <h3>ğŸ“¥ è®€å–èˆŠé€²åº¦</h3>
            <textarea id="paste-area" placeholder="è²¼ä¸Š Keep ç­†è¨˜..."></textarea>
            <button class="btn btn-load" onclick="loadFromKeep()">ğŸ”„ è§£æä¸¦å¡«å…¥å·¦å´</button>
        </div>
        <div class="card result-zone">
            <h3>ğŸ“¤ æœ€çµ‚çµæœ</h3>
            <textarea id="final-result" readonly></textarea>
            <button class="btn btn-gen" onclick="copyResult()">âœ¨ å…¨é¸ä¸¦è¤‡è£½</button>
        </div>
    </div>

</div>

<script>
    document.querySelectorAll('textarea').forEach(el => {
        el.addEventListener('input', function() { autoGrow(this); generate(); });
    });
    function autoGrow(el) { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; }
    function triggerResizeAll() { document.querySelectorAll('.input-box').forEach(autoGrow); }

    function formatLinks() {
        const box = document.getElementById('resources');
        let text = box.value;
        text = text.replace(/([^\n])(\[)/g, '$1\n$2');
        text = text.replace(/([^\n])(https?:\/\/)/g, '$1\n$2');
        box.value = text;
        autoGrow(box);
        generate();
    }

    // --- V20 æ ¸å¿ƒï¼šæ™ºæ…§æˆªæ–·é‚è¼¯ ---
    function loadFromKeep() {
        const text = document.getElementById('paste-area').value;
        if (!text.trim()) { alert("è«‹å…ˆè²¼ä¸Šå…§å®¹ï¼"); return; }
        
        // å¢å¼·ç‰ˆæå–å‡½æ•¸ (æ”¯æ´æ’é™¤é—œéµå­—)
        function extract(start, end, excludeList = []) {
            const sIdx = text.indexOf(start);
            if (sIdx === -1) return "";
            
            let content = "";
            let subText = text.substring(sIdx + start.length); // å…ˆæŠ“èµ·é»ä¹‹å¾Œçš„æ‰€æœ‰å…§å®¹
            
            // æ‰¾å‡ºæœ€è¿‘çš„çµæŸé» (å¯èƒ½æ˜¯ end æ¨™è¨˜ï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶ä»–æ¬„ä½çš„æ¨™é¡Œ)
            let minEndIdx = subText.length;
            
            if (end && subText.indexOf(end) !== -1) {
                minEndIdx = Math.min(minEndIdx, subText.indexOf(end));
            }
            
            // *é—œéµä¿®æ­£*ï¼šæª¢æŸ¥æ˜¯å¦æ’åˆ°å…¶ä»–æ¬„ä½çš„æ¨™é¡Œ (é˜²æ­¢åƒæ‰å¾Œé¢çš„å…§å®¹)
            if (excludeList.length > 0) {
                excludeList.forEach(marker => {
                    const markerIdx = subText.indexOf(marker);
                    if (markerIdx !== -1) {
                        minEndIdx = Math.min(minEndIdx, markerIdx);
                    }
                });
            }

            return subText.substring(0, minEndIdx).trim();
        }

        function clean(txt) {
            return txt.split('\n').map(l => l.replace(/^[\s\t]*[â€¢-]\s*\[.?\]\s*/, '').trim()).filter(l=>l.length>0).join('\n');
        }

        document.getElementById('status').value = extract("â€¢ ç‹€æ…‹/ä¸‹ä¸€æ­¥ï¼š", "â€¢ è³‡æºåº«ï¼š");
        
        // è³‡æºåº«ï¼šé˜²æ­¢åƒåˆ°å‚™è¨»
        document.getElementById('resources').value = extract("â€¢ è³‡æºåº«ï¼š", "â€¢ å‚™è¨»/é˜²é›·ï¼š");
        
        // å‚™è¨»ï¼š*é˜²æ­¢åƒåˆ°ç›®æ¨™æˆ–åˆ†éš”ç·š* (é€™å°±æ˜¯ä½ é‡åˆ°çš„å•é¡Œ)
        // æˆ‘å€‘å‘Šè¨´å®ƒï¼šå¦‚æœçœ‹åˆ° "---" OR "ğŸ›¡ï¸ ä»»å‹™æ ¸å¿ƒ" OR "1. ç›®æ¨™"ï¼Œéƒ½è¦åœä¸‹ä¾†
        document.getElementById('memo').value = extract("â€¢ å‚™è¨»/é˜²é›·ï¼š", "---", ["ğŸ›¡ï¸ ä»»å‹™æ ¸å¿ƒ", "1. ç›®æ¨™"]);
        
        const goal = extract("1. ç›®æ¨™ï¼š", "2. é¢¨éšªï¼š");
        const risk = extract("2. é¢¨éšªï¼š", "---", ["âœ… åŸ·è¡Œæ¸…å–®", "A. æš–èº«æº–å‚™"]);
        document.getElementById('goal_risk').value = "ç›®æ¨™ï¼š" + goal + "\né¢¨éšªï¼š" + risk.replace("âš ï¸ ", "");

        document.getElementById('qa_a').value = clean(extract("A. æš–èº«æº–å‚™", "B. æ ¸å¿ƒä»»å‹™"));
        document.getElementById('qa_b').value = clean(extract("B. æ ¸å¿ƒä»»å‹™", "C. æˆæœäº¤ä»˜"));
        document.getElementById('qa_c').value = clean(extract("C. æˆæœäº¤ä»˜", "D. ç¶“é©—å­˜æª”"));
        document.getElementById('qa_d').value = clean(extract("D. ç¶“é©—å­˜æª”", "ğŸ·ï¸ é—œéµå­—ï¼š"));
        
        document.getElementById('tags').value = extract("ğŸ·ï¸ é—œéµå­—ï¼š", "âš™ï¸ è¨­å®šæª¢æŸ¥");

        triggerResizeAll(); 
        generate(); 
        document.querySelector('.editor-panel').scrollIntoView({ behavior: 'smooth' });
    }

    function generate() {
        const s = document.getElementById('status').value || "ï¼ˆæ›´æ–°ä¸­ï¼‰";
        const res = document.getElementById('resources').value || "ï¼ˆè«‹è²¼ä¸Š SOP èˆ‡é€£çµï¼‰"; 
        const m = document.getElementById('memo').value || "ç„¡";
        const gr = document.getElementById('goal_risk').value || "ç›®æ¨™ï¼šç¢ºä¿ç„¡èª¤\né¢¨éšªï¼šæ™‚é–“ç·Šè¿«";
        const tags = document.getElementById('tags').value || "#é€šç”¨"; 
        
        const currentUrl = window.location.href;

        function fmt(val, def) {
            if (!val.trim()) return `    â€¢ [ ] ${def}`;
            return val.split('\n').map(l => {
                if(!l.trim()) return "";
                return (l.includes("[ ]") || l.includes("[x]")) ? `    â€¢ ${l.trim()}` : `    â€¢ [ ] ${l.trim()}`;
            }).join('\n');
        }

        let g = "ï¼ˆæœªè¨­å®šï¼‰", r = "ï¼ˆæœªè¨­å®šï¼‰";
        const grLines = gr.split('\n');
        if(grLines[0]) g = grLines[0].replace("ç›®æ¨™ï¼š", "");
        if(grLines[1]) r = grLines[1].replace("é¢¨éšªï¼š", "");

        const t = `ğŸ’¬ èˆ‡æœªä¾†çš„è‡ªå·±å°è©±
â€¢ ç‹€æ…‹/ä¸‹ä¸€æ­¥ï¼š ${s}
â€¢ è³‡æºåº«ï¼š
${res}
â€¢ å‚™è¨»/é˜²é›·ï¼š ${m}

---

ğŸ›¡ï¸ ä»»å‹™æ ¸å¿ƒ
1. ç›®æ¨™ï¼š ${g}
2. é¢¨éšªï¼š âš ï¸ ${r}

---

âœ… åŸ·è¡Œæ¸…å–® (ABCD)

A. æš–èº«æº–å‚™
${fmt(document.getElementById('qa_a').value, "æº–å‚™åˆ°ä½")}

B. æ ¸å¿ƒä»»å‹™
${fmt(document.getElementById('qa_b').value, "æ ¸å¿ƒç”¢å‡º")}

C. æˆæœäº¤ä»˜
${fmt(document.getElementById('qa_c').value, "äº¤ä»˜é©—æ”¶")}

D. ç¶“é©—å­˜æª”
${fmt(document.getElementById('qa_d').value, "ç¶“é©—ç´€éŒ„")}

ğŸ·ï¸ é—œéµå­—ï¼š
${tags}

âš™ï¸ è¨­å®šæª¢æŸ¥
    â€¢ [ ] ğŸ”´ç´…è‰²(æ€¥) / ğŸŸ¢ç¶ è‰²(ç©©)
    â€¢ [ ] â°æ™‚é–“æé†’ / ğŸ“åœ°é»æé†’
    â€¢ [ ] ç·¨è¼¯æœ¬ç­†è¨˜ï¼š ${currentUrl}
`;
        document.getElementById('final-result').value = t;
    }

    function copyResult() {
        generate();
        const res = document.getElementById('final-result');
        res.select();
        res.setSelectionRange(0, 99999);
        document.execCommand("copy");
        
        const btn = document.querySelector('.btn-gen');
        const org = btn.innerText;
        btn.innerText = "âœ… å·²è¤‡è£½ï¼";
        setTimeout(() => btn.innerText = org, 1500);
    }
    
    generate();
</script>

</body>
</html>
